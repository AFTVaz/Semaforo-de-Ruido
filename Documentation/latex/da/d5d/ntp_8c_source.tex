\doxysection{ntp.\+c}
\hypertarget{ntp_8c_source}{}\label{ntp_8c_source}\index{C:/LEETC/SE/MCUXpressoIDE\_11.10.0\_3148/workspace/NSP/FreeRTOS\_DRIVERS/src/ntp.c@{C:/LEETC/SE/MCUXpressoIDE\_11.10.0\_3148/workspace/NSP/FreeRTOS\_DRIVERS/src/ntp.c}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00001}00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00002}00002\ \textcolor{comment}{\ *\ ntp.c}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00003}00003\ \textcolor{comment}{\ *}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00004}00004\ \textcolor{comment}{\ *\ \ Created\ on:\ 05/05/2025}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00005}00005\ \textcolor{comment}{\ *\ \ \ \ \ \ Author:\ Andr√©\ Vaz\ (48209)\ e\ Filipe\ Cruz\ (43468)}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00006}00006\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00008}00008\ \textcolor{preprocessor}{\#ifdef\ \_\_USE\_CMSIS}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00009}00009\ \textcolor{preprocessor}{\#include\ "{}LPC17xx.h"{}}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00010}00010\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00012}00012\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00013}00013\ \textcolor{preprocessor}{\#include\ <stdbool.h>}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00014}00014\ \textcolor{preprocessor}{\#include\ <string.h>}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00015}00015\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00016}00016\ \textcolor{preprocessor}{\#include\ <time.h>}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00017}00017\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00018}00018\ \textcolor{preprocessor}{\#include\ "{}FreeRTOS.h"{}}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00019}00019\ \textcolor{preprocessor}{\#include\ "{}task.h"{}}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00020}00020\ \textcolor{preprocessor}{\#include\ "{}semphr.h"{}}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00021}00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{espserial_8h}{espserial.h}}"{}}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00022}00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wifi_8h}{wifi.h}}"{}}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00023}00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ntp_8h}{ntp.h}}"{}}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00025}00025\ \textcolor{keyword}{static}\ TaskHandle\_t\ xNTPTaskHandle\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00026}00026\ \textcolor{keyword}{static}\ SemaphoreHandle\_t\ xNTPMutex\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00027}00027\ \textcolor{keyword}{static}\ time\_t\ ntp\_timestamp\ =\ 0;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00028}00028\ \textcolor{keyword}{static}\ \mbox{\hyperlink{group__NTP_ga0bf5ba4e5e4ab7ba668a6174d120bbd2}{NTP\_StateValueType}}\ xNTPState\ =\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2ad0d5745c50ace4913192a09c737b1ccc}{NTP\_IDLE}};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00029}00029\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00030}00030\ \textcolor{keyword}{static}\ uint32\_t\ ntohl(\ uint32\_t\ netlong\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00031}00031\ \ \ \ \ \textcolor{keywordflow}{return}\ \_\_builtin\_bswap32(netlong);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00032}00032\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00033}00033\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00034}00034\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ NTP\_ParseResponse(\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{void}\ *user\_data\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00035}00035\ \ \ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ NULL\ ||\ user\_data\ ==\ NULL)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00037}00037\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *ipd\ =\ strstr(buffer,\ \textcolor{stringliteral}{"{}+IPD,"{}});}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00038}00038\ \ \ \ \ \textcolor{keywordflow}{if}\ (ipd)\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00039}00039\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ link\_id\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00040}00040\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ data\_len\ =\ 0;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00041}00041\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *header\_end\ =\ strchr(ipd,\ \textcolor{charliteral}{':'});}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00043}00043\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (header\_end)\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00044}00044\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ fields\ =\ sscanf(ipd,\ \textcolor{stringliteral}{"{}+IPD,\%d,\%d:"{}},\ \&link\_id,\ \&data\_len);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00045}00045\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fields\ ==\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00046}00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\_len\ =\ link\_id;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00047}00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ link\_id\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00048}00048\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (fields\ ==\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00049}00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(link\_id\ !=\ NTP\_SERVICE\_ID)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ data\_len\ ==\ NTP\_PACKET\_SIZE\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structNTP__Packet}{NTP\_Packet}}\ rxPacket;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ len\ =\ \mbox{\hyperlink{group__ESPSERIAL_ga05cf9bb05ee1c4efa2e8f529b402b3ad}{ESPSERIAL\_Recv}}((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)\&rxPacket,\ NTP\_PACKET\_SIZE);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ len\ ==\ NTP\_PACKET\_SIZE\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ secs\_net\ =\ rxPacket.txTm\_s;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint32\_t\ secs\ =\ ntohl(secs\_net);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00060}00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ time\_t\ *timestamp\ =\ (time\_t\ *)user\_data;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *timestamp\ =\ (time\_t)(secs\ -\/\ UNIX\_EPOCH);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00064}00064\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00065}00065\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00066}00066\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00067}00067\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00068}00068\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00070}00070\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ NTP\_Start(\ \textcolor{keywordtype}{void}\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00071}00071\ \ \ \ \ \mbox{\hyperlink{group__WIFI_gae4ffca2068d376411b7d442139e5b940}{WIFI\_ResultValueType}}\ result;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00072}00072\ \ \ \ \ \textcolor{keywordtype}{char}\ cmd[128];}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00073}00073\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00074}00074\ \ \ \ \ \textcolor{keywordtype}{int}\ cipmux\ =\ \mbox{\hyperlink{group__WIFI_ga1088673f6bfa754681ebd94cd1d95d9d}{WIFI\_GetCIPMUX}}();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00075}00075\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00076}00076\ \ \ \ \ \textcolor{keywordflow}{if}\ (cipmux\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00077}00077\ \ \ \ \ \ \ \ \ snprintf(cmd,\ \textcolor{keyword}{sizeof}(cmd),\ \textcolor{stringliteral}{"{}AT+CIPSTART=\(\backslash\)"{}\%s\(\backslash\)"{},\(\backslash\)"{}\%s\(\backslash\)"{},\%d\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NTP\_CONN\_TYPE,\ NTP\_SERVER,\ NTP\_REMOTE\_PORT);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00079}00079\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00080}00080\ \ \ \ \ \ \ \ \ snprintf(cmd,\ \textcolor{keyword}{sizeof}(cmd),\ \textcolor{stringliteral}{"{}AT+CIPSTART=\%d,\(\backslash\)"{}\%s\(\backslash\)"{},\(\backslash\)"{}\%s\(\backslash\)"{},\%d\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NTP\_SERVICE\_ID,\ NTP\_CONN\_TYPE,\ NTP\_SERVER,\ NTP\_REMOTE\_PORT);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00082}00082\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00083}00083\ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{group__WIFI_ga00b687aec535d88cd7da7ef3d18f8818}{WIFI\_RequestExpected}}(cmd,\ \textcolor{stringliteral}{"{}OK\(\backslash\)r\(\backslash\)n"{}},\ NTP\_CIPSTART\_TIMEOUT))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00084}00084\ \ \ \ \ \textcolor{keywordflow}{while}\ ((result\ =\ \mbox{\hyperlink{group__WIFI_gac78a6121cc4aa70164b3e3669b15f9fa}{WIFI\_GetResult}}())\ ==\ \mbox{\hyperlink{group__WIFI_ggae4ffca2068d376411b7d442139e5b940a660b0c3ad275d4f2afd7b895216902ed}{WIFI\_RESULT\_NONE}})\ taskYIELD();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00085}00085\ \ \ \ \ \textcolor{keywordflow}{return}\ result\ ==\ \mbox{\hyperlink{group__WIFI_ggae4ffca2068d376411b7d442139e5b940ad618369ad95452d851fe91f9901e1a1d}{WIFI\_RESULT\_SUCCESS}};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00086}00086\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00088}00088\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ NTP\_SendAndReceive(\ time\_t\ *timestamp\ )\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00089}00089\ \ \ \ \ \textcolor{keywordflow}{if}\ (timestamp\ ==\ NULL)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00090}00090\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00091}00091\ \ \ \ \ \mbox{\hyperlink{group__WIFI_gae4ffca2068d376411b7d442139e5b940}{WIFI\_ResultValueType}}\ result;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00092}00092\ \ \ \ \ \textcolor{keywordtype}{char}\ cmd[128];}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00093}00093\ \ \ \ \ \mbox{\hyperlink{structNTP__Packet}{NTP\_Packet}}\ packet;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00094}00094\ \ \ \ \ memset(\&packet,\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structNTP__Packet}{NTP\_Packet}}));}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00096}00096\ \ \ \ \ packet.li\_vn\_mode\ =\ 0xE3;\ \ \ \textcolor{comment}{//\ LI=3,\ VN=4,\ Mode=3}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00097}00097\ \ \ \ \ packet.stratum\ =\ 0;\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Stratum}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00098}00098\ \ \ \ \ packet.poll\ =\ 6;\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Poll\ interval}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00099}00099\ \ \ \ \ packet.precision\ =\ 0xEC;\ \ \ \ \textcolor{comment}{//\ Precision}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00100}00100\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00101}00101\ \ \ \ \ \textcolor{keywordtype}{int}\ cipmux\ =\ \mbox{\hyperlink{group__WIFI_ga1088673f6bfa754681ebd94cd1d95d9d}{WIFI\_GetCIPMUX}}();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00102}00102\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00103}00103\ \ \ \ \ \textcolor{keywordflow}{if}\ (cipmux\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00104}00104\ \ \ \ \ \ \ \ \ snprintf(\ cmd,\ \textcolor{keyword}{sizeof}(cmd),\ \textcolor{stringliteral}{"{}AT+CIPSEND=\%d\(\backslash\)r\(\backslash\)n"{}},\ NTP\_PACKET\_SIZE\ );}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00105}00105\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00106}00106\ \ \ \ \ \ \ \ \ snprintf(\ cmd,\ \textcolor{keyword}{sizeof}(cmd),\ \textcolor{stringliteral}{"{}AT+CIPSEND=\%d,\%d\(\backslash\)r\(\backslash\)n"{}},\ NTP\_SERVICE\_ID,\ NTP\_PACKET\_SIZE\ );}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00107}00107\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00108}00108\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00109}00109\ \ \ \ \ TickType\_t\ xStart\ =\ xTaskGetTickCount();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00110}00110\ \ \ \ \ \textcolor{keywordflow}{while}\ ((xTaskGetTickCount()\ -\/\ xStart)\ <\ NTP\_TRANSACTION\_TIMEOUT)\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00111}00111\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{group__WIFI_ga89dede821c4ab011d3ca1641c168a42e}{WIFI\_RequestPacketTransaction}}(}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cmd,}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00113}00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (uint8\_t*)\&packet,}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NTP\_PACKET\_SIZE,}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NTP\_TRANSACTION\_TIMEOUT,}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00116}00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NTP\_ParseResponse,}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00117}00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ timestamp)}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00118}00118\ \ \ \ \ \ \ \ \ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00119}00119\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ ((result\ =\ \mbox{\hyperlink{group__WIFI_gac78a6121cc4aa70164b3e3669b15f9fa}{WIFI\_GetResult}}())\ ==\ \mbox{\hyperlink{group__WIFI_ggae4ffca2068d376411b7d442139e5b940a660b0c3ad275d4f2afd7b895216902ed}{WIFI\_RESULT\_NONE}})\ taskYIELD();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00120}00120\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result\ ==\ \mbox{\hyperlink{group__WIFI_ggae4ffca2068d376411b7d442139e5b940ad618369ad95452d851fe91f9901e1a1d}{WIFI\_RESULT\_SUCCESS}};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00121}00121\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00122}00122\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ vTaskDelay(NTP\_WAIT\_DELAY);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00123}00123\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00124}00124\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00125}00125\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00126}00126\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00127}00127\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00128}00128\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ NTP\_Close(\ \textcolor{keywordtype}{void}\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00129}00129\ \ \ \ \ \mbox{\hyperlink{group__WIFI_gae4ffca2068d376411b7d442139e5b940}{WIFI\_ResultValueType}}\ result;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00130}00130\ \ \ \ \ \textcolor{keywordtype}{int}\ cipmux\ =\ \mbox{\hyperlink{group__WIFI_ga1088673f6bfa754681ebd94cd1d95d9d}{WIFI\_GetCIPMUX}}();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00131}00131\ \ \ \ \ \textcolor{keywordtype}{char}\ cmd[32];}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00132}00132\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00133}00133\ \ \ \ \ \textcolor{keywordflow}{if}\ (cipmux\ ==\ 0)\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00134}00134\ \ \ \ \ \ \ \ \ snprintf(cmd,\ \textcolor{keyword}{sizeof}(cmd),\ \textcolor{stringliteral}{"{}AT+CIPCLOSE\(\backslash\)r\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00135}00135\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00136}00136\ \ \ \ \ \ \ \ \ snprintf(cmd,\ \textcolor{keyword}{sizeof}(cmd),\ \textcolor{stringliteral}{"{}AT+CIPCLOSE=\%d\(\backslash\)r\(\backslash\)n"{}},\ NTP\_SERVICE\_ID);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00137}00137\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00138}00138\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00139}00139\ \ \ \ \ \textcolor{keywordflow}{while}\ (!\mbox{\hyperlink{group__WIFI_ga00b687aec535d88cd7da7ef3d18f8818}{WIFI\_RequestExpected}}(cmd,\ \textcolor{stringliteral}{"{}OK\(\backslash\)r\(\backslash\)n"{}},\ NTP\_CIPCLOSE\_TIMEOUT))}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00140}00140\ \ \ \ \ \ \ \ \ vTaskDelay(NTP\_WAIT\_DELAY);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00141}00141\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00142}00142\ \ \ \ \ \textcolor{keywordflow}{while}\ ((result\ =\ \mbox{\hyperlink{group__WIFI_gac78a6121cc4aa70164b3e3669b15f9fa}{WIFI\_GetResult}}())\ ==\ \mbox{\hyperlink{group__WIFI_ggae4ffca2068d376411b7d442139e5b940a660b0c3ad275d4f2afd7b895216902ed}{WIFI\_RESULT\_NONE}})\ taskYIELD();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00143}00143\ \ \ \ \ \textcolor{keywordflow}{return}\ result\ ==\ \mbox{\hyperlink{group__WIFI_ggae4ffca2068d376411b7d442139e5b940ad618369ad95452d851fe91f9901e1a1d}{WIFI\_RESULT\_SUCCESS}};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00144}00144\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00145}00145\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00146}00146\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ NTP\_SetState(\ \mbox{\hyperlink{group__NTP_ga0bf5ba4e5e4ab7ba668a6174d120bbd2}{NTP\_StateValueType}}\ state\ )\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00147}00147\ \ \ \ \ \textcolor{keywordflow}{if}\ (xNTPMutex\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00148}00148\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(xNTPMutex,\ WIFI\_SET\_STATE\_TIMEOUT)\ ==\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ xNTPState\ =\ state;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00150}00150\ \ \ \ \ \ \ \ \ \ \ \ \ xSemaphoreGive(xNTPMutex);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00151}00151\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00152}00152\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00153}00153\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00154}00154\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00155}00155\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ NTP\_Task(\textcolor{keywordtype}{void}\ *pvParameters)\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00156}00156\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00157}00157\ \ \ \ \ \textcolor{keywordtype}{bool}\ connStart\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00159}00159\ \ \ \ \ time\_t\ timestamp\ =\ 0;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00160}00160\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00161}00161\ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00162}00162\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00163}00163\ \ \ \ \ \ \ \ \ ulTaskNotifyTake(pdTRUE,\ portMAX\_DELAY);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00164}00164\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00165}00165\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{group__WIFI_gae29d3d42ede730fcfcfca691499ab202}{WIFI\_GetState}}()\ ==\ \mbox{\hyperlink{group__WIFI_ggac3e1df69c2227ca79c44dd2c017124c6a95788594e2b516407be3e3e5e4484186}{WIFI\_STATE\_CONNECTED}})\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00166}00166\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{group__NTP_gae13b25d0c1ba975c33fa6df1ea85be8b}{NTP\_GetState}}()\ ==\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2ab8804aa21d5a07c2496574041d4ba5b1}{NTP\_PROCESSING}})\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00167}00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!connStart)\ connStart\ =\ NTP\_Start();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00168}00168\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00169}00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(connStart)\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00170}00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ NTP\_SendAndReceive(\ \&timestamp)\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00171}00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ xSemaphoreTake(xNTPMutex,\ portMAX\_DELAY)\ ==\ pdTRUE\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00172}00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ntp\_timestamp\ =\ timestamp;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ xNTPState\ =\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2a33157c0f963d4fe6e5f80ce0f1c45277}{NTP\_READY}};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ xSemaphoreGive(xNTPMutex);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00176}00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NTP\_SetState(\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2ad0d5745c50ace4913192a09c737b1ccc}{NTP\_IDLE}}\ );}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NTP\_Close();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ connStart\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00180}00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00182}00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00183}00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NTP\_SetState(\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2ad0d5745c50ace4913192a09c737b1ccc}{NTP\_IDLE}}\ );}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00184}00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00186}00186\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00187}00187\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{group__NTP_gae13b25d0c1ba975c33fa6df1ea85be8b}{NTP\_GetState}}()\ !=\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2ad0d5745c50ace4913192a09c737b1ccc}{NTP\_IDLE}})\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00188}00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NTP\_SetState(\mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2ad0d5745c50ace4913192a09c737b1ccc}{NTP\_IDLE}});}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00190}00190\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00191}00191\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00192}00192\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00193}00193\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00194}00194\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00195}\mbox{\hyperlink{group__NTP_gaccc0fb39eb7b19f86d15e01fe6937cfe}{00195}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{group__NTP_gaccc0fb39eb7b19f86d15e01fe6937cfe}{NTP\_Init}}(\ \textcolor{keywordtype}{void}\ )\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00196}00196\ \ \ \ \ xNTPMutex\ =\ xSemaphoreCreateMutex();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00197}00197\ \ \ \ \ \textcolor{keywordflow}{if}\ (xNTPMutex\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00198}00198\ \ \ \ \ \ \ \ \ xTaskCreate(NTP\_Task,\ \textcolor{stringliteral}{"{}NTP\_Task"{}},\ 4\ *\ configMINIMAL\_STACK\_SIZE,\ NULL,\ 1,\ \&xNTPTaskHandle);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00199}00199\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00200}00200\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00201}00201\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00202}\mbox{\hyperlink{group__NTP_gaf20a777ffcf6e63cff72f0b58dabdce0}{00202}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{group__NTP_gaf20a777ffcf6e63cff72f0b58dabdce0}{NTP\_Ready}}(\ \textcolor{keywordtype}{void}\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00203}00203\ \ \ \ \ \textcolor{keywordflow}{return}\ xNTPTaskHandle\ !=\ NULL;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00204}00204\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00205}00205\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00206}\mbox{\hyperlink{group__NTP_gae13b25d0c1ba975c33fa6df1ea85be8b}{00206}}\ \mbox{\hyperlink{group__NTP_ga0bf5ba4e5e4ab7ba668a6174d120bbd2}{NTP\_StateValueType}}\ \mbox{\hyperlink{group__NTP_gae13b25d0c1ba975c33fa6df1ea85be8b}{NTP\_GetState}}(\ \textcolor{keywordtype}{void}\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00207}00207\ \ \ \ \ \mbox{\hyperlink{group__NTP_ga0bf5ba4e5e4ab7ba668a6174d120bbd2}{NTP\_StateValueType}}\ state\ =\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2ad0d5745c50ace4913192a09c737b1ccc}{NTP\_IDLE}};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00208}00208\ \ \ \ \ \textcolor{keywordflow}{if}(xNTPMutex\ !=\ NULL)\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00209}00209\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(xSemaphoreTake(xNTPMutex,\ WIFI\_GET\_STATE\_TIMEOUT)\ ==\ pdTRUE)\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00210}00210\ \ \ \ \ \ \ \ \ \ \ \ \ state\ =\ xNTPState;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00211}00211\ \ \ \ \ \ \ \ \ \ \ \ \ xSemaphoreGive(xNTPMutex);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00212}00212\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00213}00213\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00214}00214\ \ \ \ \ \textcolor{keywordflow}{return}\ state;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00215}00215\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00216}00216\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00217}\mbox{\hyperlink{group__NTP_ga794dd16f57bb514643dada07cfa61525}{00217}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{group__NTP_ga794dd16f57bb514643dada07cfa61525}{NTP\_RequestTime}}(\ \textcolor{keywordtype}{void}\ )\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00218}00218\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{group__NTP_gae13b25d0c1ba975c33fa6df1ea85be8b}{NTP\_GetState}}()\ ==\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2ad0d5745c50ace4913192a09c737b1ccc}{NTP\_IDLE}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00219}00219\ \ \ \ \ \ \ \ \ NTP\_SetState(\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2ab8804aa21d5a07c2496574041d4ba5b1}{NTP\_PROCESSING}}\ );}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00220}00220\ \ \ \ \ \ \ \ \ xTaskNotifyGive(xNTPTaskHandle);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00221}00221\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00222}00222\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00223}00223\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00224}\mbox{\hyperlink{group__NTP_ga765930b8d45a60f24169b16c3dfae7b0}{00224}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{group__NTP_ga765930b8d45a60f24169b16c3dfae7b0}{NTP\_GetTimestamp}}(\ time\_t\ *timestamp\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00225}00225\ \ \ \ \ \textcolor{keywordflow}{if}\ (timestamp\ ==\ NULL)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00226}00226\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00227}00227\ \ \ \ \ \textcolor{keywordtype}{bool}\ success\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00228}00228\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00229}00229\ \ \ \ \ \textcolor{keywordflow}{if}\ (xSemaphoreTake(xNTPMutex,\ portMAX\_DELAY)\ ==\ pdTRUE)\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00230}00230\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (xNTPState\ ==\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2a33157c0f963d4fe6e5f80ce0f1c45277}{NTP\_READY}})\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00231}00231\ \ \ \ \ \ \ \ \ \ \ \ \ time\_t\ t\ =\ ntp\_timestamp;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00232}00232\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ !=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00233}00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *timestamp\ =\ t;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00234}00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ success\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00235}00235\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00236}00236\ \ \ \ \ \ \ \ \ \ \ \ \ xNTPState\ =\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2ad0d5745c50ace4913192a09c737b1ccc}{NTP\_IDLE}};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00237}00237\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00238}00238\ \ \ \ \ \ \ \ \ xSemaphoreGive(xNTPMutex);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00239}00239\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00240}00240\ \ \ \ \ \textcolor{keywordflow}{return}\ success;}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00241}00241\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00242}00242\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00243}\mbox{\hyperlink{group__NTP_ga2e8934b32ca00d2b46751c035e0fa3dd}{00243}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{group__NTP_ga2e8934b32ca00d2b46751c035e0fa3dd}{NTP\_RequestAndWait}}(\ time\_t\ *timestamp\ )\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00244}00244\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00245}00245\ \ \ \ \ TickType\_t\ xStart\ =\ xTaskGetTickCount();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00246}00246\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00247}00247\ \ \ \ \ \mbox{\hyperlink{group__NTP_ga794dd16f57bb514643dada07cfa61525}{NTP\_RequestTime}}();}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00248}00248\ \ \ \ \ \textcolor{keywordflow}{while}\ ((xTaskGetTickCount()\ -\/\ xStart)\ <\ NTP\_TRANSACTION\_TIMEOUT)\{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00249}00249\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{group__NTP_ga765930b8d45a60f24169b16c3dfae7b0}{NTP\_GetTimestamp}}(\ timestamp\ ))\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00250}00250\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00251}00251\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00252}00252\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00253}00253\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{group__NTP_gae13b25d0c1ba975c33fa6df1ea85be8b}{NTP\_GetState}}()\ ==\ \mbox{\hyperlink{group__NTP_gga0bf5ba4e5e4ab7ba668a6174d120bbd2ad0d5745c50ace4913192a09c737b1ccc}{NTP\_IDLE}})\ \{}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00254}00254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00255}00255\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00256}00256\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00257}00257\ \ \ \ \ \ \ \ \ vTaskDelay(NTP\_WAIT\_DELAY);}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00258}00258\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00259}00259\ }
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00260}00260\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00261}00261\ \}}
\DoxyCodeLine{\Hypertarget{ntp_8c_source_l00262}00262\ }

\end{DoxyCode}
